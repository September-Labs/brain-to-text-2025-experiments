experiment:
  name: lcs_ctc_zipf_t15
  output_dir: /srv/s8l_storage/kaggle/aleks/runs/lcs_ctc_zipf_t15
  seed: 10

data:
  dataset_dir: /srv/s8l_storage/kaggle/data/brain-to-text-25/hdf5_data_final
  n_input_features: 512
  n_classes: 41
  batch_size: 128
  val_batch_size: 128
  days_per_batch: 4
  num_workers: 32
  prefetch_factor: 4
  pin_memory: false
  loader_shuffle: false
  seed: 1
  must_include_days: null
  feature_subset: null
  bad_trials_dict: null
  sessions:
    - t15.2023.08.11
    - t15.2023.08.13
    - t15.2023.08.18
    - t15.2023.08.20
    - t15.2023.08.25
    - t15.2023.08.27
    - t15.2023.09.01
    - t15.2023.09.03
    - t15.2023.09.24
    - t15.2023.09.29
    - t15.2023.10.01
    - t15.2023.10.06
    - t15.2023.10.08
    - t15.2023.10.13
    - t15.2023.10.15
    - t15.2023.10.20
    - t15.2023.10.22
    - t15.2023.11.03
    - t15.2023.11.04
    - t15.2023.11.17
    - t15.2023.11.19
    - t15.2023.11.26
    - t15.2023.12.03
    - t15.2023.12.08
    - t15.2023.12.10
    - t15.2023.12.17
    - t15.2023.12.29
    - t15.2024.02.25
    - t15.2024.03.03
    - t15.2024.03.08
    - t15.2024.03.15
    - t15.2024.03.17
    - t15.2024.04.25
    - t15.2024.04.28
    - t15.2024.05.10
    - t15.2024.06.14
    - t15.2024.07.19
    - t15.2024.07.21
    - t15.2024.07.28
    - t15.2025.01.10
    - t15.2025.01.12
    - t15.2025.03.14
    - t15.2025.03.16
    - t15.2025.03.30
    - t15.2025.04.13
  transforms:
    white_noise_std: 1.0
    constant_offset_std: 0.2
    random_walk_std: 0.0
    random_walk_axis: -1
    static_gain_std: 0.0
    random_cut: 3
    smooth_kernel_size: 100
    smooth_kernel_std: 2
    smooth_data: true

model:
  module: models.architectures.lcs_ctc_zipf
  class: LCSCTCZipf
  params:
    hidden_dim: 256
    num_conformers: 4
    num_heads: 4
    dropout_rate: 0.1
    patch_size: 14
    patch_stride: 4
    aux_dim: 64
    use_day_embedding: true
    use_zipf: true
    zipf_alpha: 0.99

task:
  module: b2txt.tasks.lcs_ctc_zipf
  class: LCSCTCZipfTask
  params:
    align_weight: 0.2
    use_zipf: true
    zipf_boost: 0.2
    zipf_apply_train: false
    zipf_apply_eval: true
    zipf_apply_blank: false
    zipf_update: true
    zipf_update_every: 1
    use_torchaudio_align: true

competition:
  wer:
    enabled: true
    decode_predictions: true
    strict: false
    decoder:
      module: b2txt.decoders.redis_lm
      class: RedisLmDecoder
      params:
        host: localhost
        port: 6379
        input_stream: remote_lm_input_aleks
        output_partial_stream: remote_lm_output_partial_aleks
        output_final_stream: remote_lm_output_final_aleks
        acoustic_scale: 0.325
        blank_penalty: 90.0
        alpha: 0.55
        update_params: false
        healthcheck: false

ctc:
  blank_id: 0
  output_length:
    type: patch
    patch_size: 14
    patch_stride: 4

training:
  num_training_batches: 5000
  use_amp: true
  compile: false
  lr: 0.002
  weight_decay: 0.001
  betas: [0.9, 0.999]
  epsilon: 0.1
  lr_scheduler:
    type: cosine
    warmup_steps: 200
    decay_steps: 5000
    min_lr: 0.0001
  grad_clip_norm: 10
  log_every_batches: 100
  val_every_batches: 1000
  save_every_batches: 0
  save_best: true
  save_last: true
  resume_checkpoint: null
  resume_optimizer: false
  device: null
  require_cuda: true
  progress_bar: true
  suppress_warnings: true
